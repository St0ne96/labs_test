<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
  
    <title>꿀단지 개발소 | </title>

    <!--사이드바 css-->
<style>
  * {padding:0;margin:0;}
  input[id="menuicon"] {display:none;}
  input[id="menuicon"] + ul {display:block;position:fixed;right:0;top:50%;transform:translateY(-50%);transition:all .35s;text-align:right;}
  input[id="menuicon"] + ul > li {display:block;width:50px;height:50px;border:1px solid #f1f1f1;position:relative;margin-top:-1px;}
  input[id="menuicon"] + ul > li > a {display:block;width:auto;height:50px;overflow:hidden;transition:all .35s;}
  input[id="menuicon"] + ul > li > label {display:block;cursor:pointer;width:auto;height:50px;background:#dadada;}
  input[id="menuicon"] + ul > li:nth-child(1) label span {display:block;position:absolute;width:50%;height:3px;border-radius:30px;background:#333;transition:all .35s;}
  input[id="menuicon"] + ul > li:nth-child(1) label span:nth-child(1) {top:30%;left:50%;transform:translateX(-50%);}
  input[id="menuicon"] + ul > li:nth-child(1) label span:nth-child(2) {top:50%;left:50%;transform:translate(-50%,-50%);}
  input[id="menuicon"] + ul > li:nth-child(1) label span:nth-child(3) {bottom:30%;left:50%;transform:translateX(-50%);}
  input[id="menuicon"] + ul > li:nth-child(2) a .icon {background:url('./img/search.png') center center no-repeat;background-size:50%;display:inline-block;width:50px;height:50px;vertical-align:middle;}
  input[id="menuicon"] + ul > li:nth-child(3) a .icon {background:url('./img/sand-clock.png') center center no-repeat;background-size:50%;display:inline-block;width:50px;height:50px;vertical-align:middle;}
  input[id="menuicon"]:checked + ul {z-index:2;right:300px;}
  input[id="menuicon"]:checked + ul > li:nth-child(1) label {z-index:2;right:300px;}
  input[id="menuicon"]:checked + ul > li:nth-child(1) label span:nth-child(1) {top:50%;left:50%;transform:translate(-50%,-50%) rotate(45deg);}
  input[id="menuicon"]:checked + ul > li:nth-child(1) label span:nth-child(2) {opacity:0;}
  input[id="menuicon"]:checked + ul > li:nth-child(1) label span:nth-child(3) {bottom:50%;left:50%;transform:translate(-50%,50%) rotate(-45deg);}
  div[class="sidebar"] {width:300px;height:100%;background:#f5f5f5;position:fixed;top:0;right:-300px;z-index:1;transition:all .35s;}
  input[id="menuicon"]:checked + ul + div {right:0;}
  
  </style>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<!-- Bootstrap CSS -->
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
  integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2"
  crossorigin="anonymous"
/>
<!-- Font Awesome CSS -->
<link
  href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
  rel="stylesheet"
/>
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
/>
<link href="../static/css/owner.css" rel="stylesheet" />

  </head>

  <body>
  
    <div
      class="jumbotron bg-sparta text-white text-center mytitle"
      onclick="window.location.href='/api/laundries/owner/'"
    >
      <h1 class="font-weight-bold"> 꿀단지 개발소 </h1>
    </div>

    <span id="ownerInfo">
      <div class="container" style="margin-top: 50px; text-align: center; margin-bottom: 20px">
        <h4 class="col" 꿀단지 연구 개발소에 오신 것을 환영합니다. </h4>
        <h4 class="col" style="margin-top:30px" id="shopName"></h4>
      </div>
      
      </div>
     <div class="container" style="margin-top: 50px">
        <h4 class="col" style="text-align: center; margin-bottom: 20px">
          현재 보유 포인트
        </h4>
        <h4 class="col" style="text-align: center; margin-bottom: 50px" id="ownerPoint"></h4>
     </div>
    </span>

    <div class="wrap">
      <div class="row d-flex justify-content-around">
        <div class="col-4 pr-2">
          <button
            onclick="open_laundry_list()"
            type="button"
            class="btn btn-sparta btn-block"
            style="margin-right: 15px"
          >
            게시글 조회 
          </button>
        </div>
        <div class="col-4 pl-2">
          <button
            onclick="open_myWork_list()"
            type="button"
            class="btn btn-outline-sparta btn-block"
          >
            방명록 조회 
          </button>
        </div>
        <div class="col-4 pl-2">
          <button
            onclick="open_review_list()"
            type="button"
            class="btn btn-outline-sparta btn-block"
          >
            미개발 
          </button>
        </div>
      </div>
    </div>
<!-------------------------------------세탁물 조회------------------------------------------->
    <div class="laundry_list" id="viewLaundries">
      <div class="container">
        <div class="row">
          <div class="col-12">
            <table class="table table-bordered" id="laundry_list">
              <thead>
                <tr>
                  <th scope="col">번호</th>
                  <th scope="col">제목</th>
                  <th scope="col">등록자</th>
                  <th scope="col">등록일</th>
                  <th scope="col">조회수</th>               
                </tr>
              </thead>
              
            </table>
          </div>
        </div>
      </div>
      <!-- 닫기 버튼-->
      <div class="wrap">
        <div class="row d-flex justify-content-around">
          <div class="col-3 pr-2">
            
            <ul class="pagination justify-content-center mt-3">
              <li class="page-item">
                  <a class="page-link" href="#">Previous</a>
              </li>
              <li class="page-item"><a id="page-1" class="page-link" href="#">1</a></li>
              <li class="page-item"><a id="page-2" class="page-link" href="#">2</a></li>
              <li class="page-item"><a id="page-3" class="page-link" href="#">3</a></li>
              <li class="page-item"><a class="page-link" href="#">Next</a></li>
          </ul>

            <button
              onclick="close_laundry_list()"
              type="button"
              class="btn btn-sparta btn-block"
              style="margin-right: 15px"
            >
              닫기
            </button>
          </div>
        </div>
      </div>
    </div>

<!-------------------------------------작업물 조회------------------------------------------->
    <div class="laundry_list" id="viewWorkLists">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <table class="table table-bordered" id="viewWorks">
            <thead>
              <tr>
                <th scope="col">번호</th>
                <th scope="col">한줄평</th>
                <th scope="col">등록자</th>
                <th scope="col">등록일</th>          
              </tr>
            </thead>
            

          </table>
        </div>
      </div>
    </div>
    <!-- 닫기 버튼-->
    <div class="wrap">
      <div class="row d-flex justify-content-around">
        <div class="col-3 pr-2">
          <button
            onclick="close_myWork_list()"
            type="button"
            class="btn btn-sparta btn-block"
            style="margin-right: 15px"
          >
            닫기
          </button>
        </div>
      </div>
    </div>
  </div>

<!-- -----------------------------------리뷰 조회-----------------------------------------
  <div class="laundry_list" id="viewReview">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <table class="table table-bordered" id="viewMyReview">
            <thead>
              <tr>
                <th scope="col">#</th>
                <th scope="col">세탁물</th>
                <th scope="col">요청사항</th>
                <th scope="col">사진</th>
                <th scope="col">생성일</th>
                <th scope="col">리뷰</th>
              </tr>
            </thead>


          </table>
        </div>
      </div>
    </div>
    닫기 버튼
    <div class="wrap">
      <div class="row d-flex justify-content-around">
        <div class="col-3 pr-2">
          <button
            onclick="close_review_list()"
            type="button"
            class="btn btn-sparta btn-block"
            style="margin-right: 15px"
          >
            닫기
          </button>
        </div>
      </div>
    </div>
  </div>
-->

  <!-- Modalalert-->
    <div
      class="modal text-left"
      id="alertModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="alertModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="alertModalLabel">알림</h5>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body" id="alertText"></div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-outline-sparta btn-confirm"
              data-dismiss="modal"
            >
              확인
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script
      src="https://code.jquery.com/jquery-3.5.1.js"
      integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
      integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js"
      integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s"
      crossorigin="anonymous"
    ></script>
<!-- 
    <script src="/api.js"></script> -->
  
    <script>
      let owner;
      getSelf(function (o) {
      owner = o;
      });

      $(document).ready(function () {
        my_Info();
      });
      
      function open_laundry_list() {
        $('#viewWorkLists').hide();
        $('#viewReview').hide();
        laundry_list()
        $('#viewLaundries').show()
      }

      function close_laundry_list() {
        $('#viewLaundries').hide();
      }

      function open_myWork_list() {
        $('#viewLaundries').hide();
        $('#viewReview').hide();
        myWork_list()
        $('#viewWorkLists').show()
      }

      function close_myWork_list() {
        $('#viewWorkLists').hide();
      }

      function open_review_list() {
        $('#viewLaundries').hide();
        $('#viewWorkLists').hide();
        myReview_list()
        $('#viewReview').show()
      }

      function close_review_list() {
        $('#viewReview').hide();
      }

//  페이지 시작 시 작동 --------------------
$(document).ready(() => {
    let pagenumber = localStorage.getItem('pagenumber')
    if (!pagenumber) {
        laundry_list(1)
    } else {
        laundry_list(parseInt(pagenumber))
    }
    document.getElementById('page-1').addEventListener('click', () => {
        localStorage.setItem('pagenumber', 1)
        laundry_list(1)
    })

    document.getElementById('page-2').addEventListener('click', () => {
        localStorage.setItem('pagenumber', 2)
        laundry_list(2)
    })

    document.getElementById('page-3').addEventListener('click', () => {
        localStorage.setItem('pagenumber', 3)
        laundry_list(3)
    })
  })

      // 가게이름 & 포인트 조회
      function my_Info() {
        $.ajax({
          type: 'GET',
          url: '/api/laundries/owner/',
          data: {},
          success: function (response) {
            let info = response['owner'];
            let shopName = info['shopName']
            let ownerPoint = info['ownerPoint']

            $('#shopName').append(shopName);
            $('#ownerPoint').append(ownerPoint);
          },
        });
      }

      //세탁물 조회
      function laundry_list(parameter) {
        $.ajax({
          type: 'GET',
          url: `/api/laundries/owner/laundry_list?pageNum=${parameter}`,
          data: {},
          success: function (response) {
            let rows = response['laundries'];

            $('#laundry_list').empty()

            for (let i = 0; i < rows.length; i++) {
              let laundryId = rows[i]['laundryId'];
              let userId = rows[i]['userId']
              let laundryName = rows[i]['laundryName'];
              let request = rows[i]['request'];
              let img = rows[i]['img'];
              let status = rows[i]['status'];
              let createdAt = rows[i]['createdAt'];

              let temp_html = `<tbody>
                                <tr>
                                  <th scope="row">${laundryId}</th>
                                  <td>${laundryName}</td>
                                  <td>${request}</td>
                                  <td>${img}</td>
                                  <td>${status}</td>
                                  <td>${createdAt}</td>
                                  <td>
                                    <button onclick="(${userId})" type="button" class="btn btn-success"><i class="fa fa-user"></i></button>
                                    <button onclick="addToMyWork(${laundryId})" type="button" class="btn btn-dark"><i class="fa fa-truck"></i></button>
                                  </td>
                                </tr>
                              </tbody>`;
              $('#laundry_list').append(temp_html);
            }
          },
        });
      }

      //세탁물 담기
      function addToMyWork(laundryId) {
        $.ajax({
          type: 'POST',
          url: `/api/laundries/owner/laundry_list/${laundryId}/add`,
          data: {},
          success: function (response) {
            customAlert(response['msg'], function () {
              window.location.reload();
            });
          },
          error: function (error) {
            customAlert(error.responseJSON.errorMessage);
          }
        });
      }

      //작업물 조회
      function myWork_list() {
        $.ajax({
          type: 'GET',
          url: '/api/laundries/owner/ownerWorkList',
          data: {},
          success: function (response) {
            let rows = response['getMyWork'];

            for (let i = 0; i < rows.length; i++) {
              let laundryId = rows[i]['laundryId'];
              let userId = rows[i]['userId']
              let laundryName = rows[i]['laundryName'];
              let request = rows[i]['request'];
              let img = rows[i]['img'];
              let status = rows[i]['status'];
              let createdAt = rows[i]['createdAt'];
              
              let temp_html = `<tbody>
                                <tr>
                                  <th scope="row">${laundryId}</th>
                                  <td>${laundryName}</td>
                                  <td>${request}</td>
                                  <td>${img}</td>
                                  <td>${status}</td>
                                  <td>${createdAt}</td>
                                  <td>
                                    <form>
                                      <select onchange="updateStatus(${laundryId})" id="select_status_${laundryId}">
                                        <option>-- 업데이트 --</option>
                                        <optgroup label="세탁물 배송상태">
                                          <option>수거 완료</option>
                                          <option>배송 중</option>
                                          <option>배송 완료</option>                                
                                        </optgroup>
                                      </select>
                                    </form>
                                  </td>
                                  <td>
                                  <button onclick="(${userId})" type="button" class="btn btn-success"><i class="fa fa-user"></i></button>
                                  <button type="button" onclick="deleteWork(${laundryId})" class="btn btn-danger"><i class="fa fa-trash"></i></button>
                                  </td>
                                </tr>
                              </tbody>`
              $('#viewWorks').append(temp_html);
            }
          },
        });
      }

      // 세탁물 배송상황 변경하기
      function updateStatus(laundryId) {
        const status = $(`#select_status_${laundryId}`).val();
        $.ajax({
          type: 'PUT',
          url: `/api/laundries/owner/ownerWorkList/${laundryId}/edit`,
          data: { status },
          success: function (response) {
            customAlert(response['msg'], function () {
              window.location.reload();
            });
          },
        });
      }

      // 작업취소하기
      function deleteWork(laundryId) {
        $.ajax({
          type: 'DELETE',
          url: `/api/laundries/owner/ownerWorkList/${laundryId}/delete`,
          data: {},
          success: function (response) {
            customAlert(response['msg'], function () {
              window.location.reload();
            });
          },
        });
      }

      // 리뷰 조회
      function myReview_list() {
        $.ajax({
          type: 'GET',
          url: '/api/laundries/owner/ownerReview',
          data: {},
          success: function (response) {
            let rows = response['myReviews'];

            for (let i = 0; i < rows.length; i++) {
              let laundryId = rows[i]['laundryId'];
              let userId = rows[i]['userId']
              let laundryName = rows[i]['laundryName'];
              let request = rows[i]['request'];
              let img = rows[i]['img'];
              let createdAt = rows[i]['createdAt'];
              let review = rows[i]['reveiw'];
              
              let temp_html = `<tbody>
                                <tr>
                                  <th scope="row">${laundryId}</th>
                                  <td>${laundryName}</td>
                                  <td>${request}</td>
                                  <td>${img}</td>
                                  <td>${createdAt}</td>
                                  <td>${review}</td>
                                </tr>
                              </tbody>`
              $('#viewMyReview').append(temp_html);
            }
          },
        });
      }

    </script>
  </body>
</html>
